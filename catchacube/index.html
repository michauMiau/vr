<!DOCTYPE html>
<html>
<head>
    <title>Catchacub</title>
    <script src="https://aframe.io/releases/1.2.0/aframe.min.js"></script>
</head>
<body>
    <a-scene vr-mode-ui="enabled: true">
        <a-sky color="#ECECEC"></a-sky>
        
        <!-- Visible floor at a fixed height -->
        <a-plane id="floor" position="0 -1.5 0" rotation="-90 0 0" width="10" height="10" color="#00FF00"></a-plane>
        
        <a-entity id="falling-cubes"></a-entity>
        
        <!-- Oculus Touch controllers -->
        <a-entity id="leftController" oculus-touch-controls="hand: left" visible="true"></a-entity>
        <a-entity id="rightController" oculus-touch-controls="hand: right" visible="true"></a-entity>
        
        <!-- Points counter displayed on the sky -->
        <a-text id="point-score-sky" value="Points: 0" align="center" width="6" color="#FF5733" position="0 2 -4"></a-text>
    </a-scene>

    <script>
        const fallingCubes = document.querySelector('#falling-cubes');
        const pointScoreEntity = document.querySelector('#point-score-sky');

        let pointScore = 0;

        const boundarySize = 1.5;
        const maxBoundaryX = boundarySize / 2;
        const maxBoundaryZ = boundarySize / 2;

        const leftController = document.querySelector('#leftController');
        const rightController = document.querySelector('#rightController');

        function randomPosition() {
            return {
                x: (Math.random() - 0.5) * maxBoundaryX * 2,
                y: 3,
                z: (Math.random() - 0.5) * maxBoundaryZ * 2
            };
        }

        function createFallingCube() {
            const cube = document.createElement('a-box');
            const position = randomPosition();
            cube.setAttribute('position', position);
            cube.setAttribute('class', 'cube');
            cube.setAttribute('color', '#FF5733');
            cube.setAttribute('width', '0.5');
            cube.setAttribute('height', '0.5');
            cube.setAttribute('depth', '0.5');
            fallingCubes.appendChild(cube);

            const fallSpeed = 0.2; // meters per second
            const updateInterval = 16; // milliseconds (60 FPS)
            
            const updatePosition = () => {
                position.y -= fallSpeed * (updateInterval / 1000); // Update y position based on fallSpeed and time interval
                cube.setAttribute('position', position);
                if (position.y < -1.5) { // If cube falls below the floor, destroy it and deduct points
                    fallingCubes.removeChild(cube);
                    pointScore -= 5; // Deduct points when cube is destroyed by touching the floor
                    updatePointScore();
                } else {
                    setTimeout(updatePosition, updateInterval);
                }
            };
            
            updatePosition();
        }

        function updatePointScore() {
            pointScoreEntity.setAttribute('value', `Points: ${pointScore}`);
        }

        function checkCollisions(controller) {
            const intersectedCubes = controller.components['oculus-touch-controls'].intersectedEls;
            for (const cube of intersectedCubes) {
                if (cube.classList.contains('cube')) {
                    fallingCubes.removeChild(cube);
                    pointScore += 10;
                    updatePointScore();
                }
            }
        }

        setInterval(createFallingCube, 2000); // Create a new cube every 2 seconds
        updatePointScore();

        // Check for collisions on every frame
        const sceneEl = document.querySelector('a-scene');
        sceneEl.addEventListener('loaded', () => {
            sceneEl.addEventListener('enter-vr', () => {
                sceneEl.addEventListener('renderstart', () => {
                    checkCollisions(leftController);
                    checkCollisions(rightController);
                });
            });
        });
    </script>
</body>
</html>
