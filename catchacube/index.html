<!DOCTYPE html>
<html>
<head>
    <title>Catchacub</title>
    <script src="https://aframe.io/releases/1.2.0/aframe.min.js"></script>
</head>
<body>
    <a-scene vr-mode-ui="enabled: true">
        <a-sky color="#ECECEC"></a-sky>
        <a-entity id="player" camera position="0 1.6 0" look-controls>
            <!-- Add visible controllers -->
            <a-entity oculus-touch-controls="hand: left" raycaster="objects: .catchable" visible="true"></a-entity>
            <a-entity oculus-touch-controls="hand: right" raycaster="objects: .catchable" visible="true"></a-entity>
        </a-entity>
        
        <!-- Visible floor at a fixed height -->
        <a-plane id="floor" position="0 -1.5 0" rotation="-90 0 0" width="10" height="10" color="#00FF00"></a-plane>
        
        <a-entity id="falling-cubes"></a-entity>
        
        <!-- Point score display -->
        <a-entity id="point-score" text="value: Points: 0; align: center; width: 3; color: #FF5733; position: 0 3 -5"></a-entity>
    </a-scene>

    <script>
        const fallingCubes = document.querySelector('#falling-cubes');
        const pointScoreEntity = document.querySelector('#point-score');

        let pointScore = 0;

        const boundarySize = 1.5;
        const maxBoundaryX = boundarySize / 2;
        const maxBoundaryZ = boundarySize / 2;

        function randomPosition() {
            return {
                x: (Math.random() - 0.5) * maxBoundaryX * 2,
                y: 3,
                z: (Math.random() - 0.5) * maxBoundaryZ * 2
            };
        }

        function createFallingCube() {
            // ... (rest of the createFallingCube function remains unchanged)
        }

        function updatePointScore() {
            pointScoreEntity.setAttribute('text', `value: Points: ${pointScore}; align: center; width: 3; color: #FF5733; position: 0 3 -5`);
        }

        setInterval(createFallingCube, 2000); // Create a new cube every 2 seconds
        updatePointScore();

        // Define controller entities
        const leftControllerEntity = document.querySelector('[oculus-touch-controls="hand: left"]');
        const rightControllerEntity = document.querySelector('[oculus-touch-controls="hand: right"]');

        // Define the XR session and reference space
        let xrSession;
        let referenceSpace;

        // Request XR session and initialize the loop
        async function initXR() {
            if ('xr' in navigator) {
                const session = await navigator.xr.requestSession('immersive-vr');
                xrSession = session;
                referenceSpace = await session.requestReferenceSpace('local-floor');
    
                // Start the animation loop
                animate();
            } else {
                console.error('WebXR not supported');
            }
        }

        // Inside the XR session loop
        function animate() {
            if (xrSession) {
                const frame = xrSession.requestAnimationFrame(animate);
                updateControllerPositions(frame);
            }
        }

        // Call the XR initialization function
        initXR();
    </script>
</body>
</html>
