<!DOCTYPE html>
<html>
<head>
    <title>Catchacub</title>
    <script src="https://aframe.io/releases/1.2.0/aframe.min.js"></script>
</head>
<body>
    <a-scene vr-mode-ui="enabled: true">
        <a-sky color="#ECECEC"></a-sky>
        <a-entity id="player" camera position="0 1.6 0" look-controls>
            <a-entity cursor="rayOrigin: mouse" raycaster="objects: .catchable" geometry="primitive: ring; radiusInner: 0.02; radiusOuter: 0.03" material="color: black; shader: flat"></a-entity>
            <!-- Add visible controllers -->
            <a-entity oculus-touch-controls="hand: left" raycaster="objects: #floor"></a-entity>
            <a-entity oculus-touch-controls="hand: right" raycaster="objects: #floor"></a-entity>
        </a-entity>
        
        <!-- Visible floor at a fixed height -->
        <a-plane id="floor" position="0 -1.5 0" rotation="-90 0 0" width="10" height="10" color="#00FF00"></a-plane>
        
        <a-entity id="falling-cubes"></a-entity>
    </a-scene>

    <script>
        const fallingCubes = document.querySelector('#falling-cubes');
        const floorEntity = document.querySelector('#floor');
        const player = document.querySelector('#player');
        const playerCamera = player.querySelector('[camera]');

        const boundarySize = 1.5;
        const maxBoundaryX = boundarySize / 2;
        const maxBoundaryZ = boundarySize / 2;

        function randomPosition() {
            return {
                x: (Math.random() - 0.5) * maxBoundaryX * 2,
                y: 3,
                z: (Math.random() - 0.5) * maxBoundaryZ * 2
            };
        }

        function createFallingCube() {
            const cube = document.createElement('a-box');
            const position = randomPosition();
            cube.setAttribute('position', position);
            cube.setAttribute('class', 'catchable');
            cube.setAttribute('color', '#FF5733');
            cube.setAttribute('width', '0.5');
            cube.setAttribute('height', '0.5');
            cube.setAttribute('depth', '0.5');
            cube.addEventListener('click', () => {
                fallingCubes.removeChild(cube);
            });
            fallingCubes.appendChild(cube);
        }

        setInterval(createFallingCube, 2000); // Create a new cube every 2 seconds

        // Adjust floor height using controllers
        const leftController = document.querySelector('[oculus-touch-controls="hand: left"]');
        const rightController = document.querySelector('[oculus-touch-controls="hand: right"]');
        const floorHeightIncrement = 0.1;

        leftController.addEventListener('abuttondown', () => {
            const currentPosition = floorEntity.getAttribute('position');
            const newPosition = { ...currentPosition };
            newPosition.y += floorHeightIncrement;
            floorEntity.setAttribute('position', newPosition);
        });

        rightController.addEventListener('abuttondown', () => {
            const currentPosition = floorEntity.getAttribute('position');
            const newPosition = { ...currentPosition };
            newPosition.y -= floorHeightIncrement;
            floorEntity.setAttribute('position', newPosition);
        });
    </script>
</body>
</html>
